Title: Reconciling dLocal transactions manually
URL: https://gustohq.atlassian.net/wiki/spaces/PlatformOperations/pages/169411668
================================================================================

Background: dLocal has been experiencing issues with CNY payments - the bank transactions amount and associated dLocal batch will be off (< $1) due to volatility issues. However, Payment Ops has the necessary tooling to self-serve and reconcile these transactions!Steps to manually reconcile:If you see an unreconciled dLocal transaction, please check the dLocal batch page to locate an unreconciled batch closest to the unreconciled amountExample: https://app.gusto.com/panda/bank_transactions/33217702 ($54,863.80)I was able to locate this unreconciled batch: https://app.gusto.com/panda/rt_payment_batches/401 ($54,863.86)Once you identify the above, please surface this over to the #payments-intl-core channel and tag the int-products-on-call handle. Please include the links to the bank transaction and unreconciled batches, and include the amounts for visibility. Please also ask which payment is causing the volatility issue (example below) The ICP eng team will comment with the sheet highlighting the problematic payment:From there, you can open the sheet to see which transfer was problematic:In this example, you can see the ID of the problematic batch (25233) and the difference in column P ($0.06). This difference should match the difference between the total amount BT and total amount of the entire RT batch.Open up the affected transfer: https://app.gusto.com/panda/rt_payment_payments/25233 From there, you'll want to open up the EP creator tool. We'll need to create two electronic payments:The first electronic payment to create will have reporting to represent the discrepancyThe second electronic payment to create will have reporting to represent the original batchTo create the first electronic payment with the discrepancy:Open the EP creator toolUse the Copy and Edit Reporting flow and input the problematic RT payment and the ID (IMPORTANT NOTE: If dlocal debited us LESS than the amount on the batch, you need to create the discrepancy EP with a debit direction (make sure you hit Reverse Direction)If dlocal debited us MORE than the amount on the batch, you need to create the discrepancy EP with a credit directionIn the example, because dLocal debited us less ($54,863.80) than the original batch ($54,863.86), I'll be creating an EP for $0.06 in a debit directionFrom there, change the amounts on the Payment Records and Payment Accounts that represent the volatility amountHit Submit to create your EP   7. To create the second electronic payment with reporting from the original batch:You'll need to query for the list of rt_payment_payments in order to use the EP creator toolYou can use this query to plug in the original batch ID In this example, I used the query to use the original batch ID (401) from this link: https://app.gusto.com/panda/rt_payment_batches/401Once you execute the query, please ensure the amount of line items in your query match the total amount of rt_payment_payments! In this example, there's 71 payments and the numbers match in the query as wellFrom there, download the CSV from the query and use the rt_payment_payments in the report to use in the EP creator toolUse the Copy and Edit Reporting flow → plug in the list of rt_payment_payments IDsEnsure the amount shown in the tool matches the RT payment batchClick to submit your EP!   8. Once you have both EPs available, you can go ahead and reconcile the dlocal transaction!IMPORTANT NOTE: Please remember to void out the original batch after and comment with the EP!Example: https://app.gusto.com/panda/rt_payment_batches/4019. Last step! By reconciling it this way, it will unfortunately fire off false positive PIs  Please use the PI dashboard and filter under the Pending Non microvariance for review and update it to today's dateFrom there, download the CSV and filter only for International Contractor Payment PIsPlease use a Google spreadsheet to throw the list of PIs and only include International Contractor Payments!Send the list to the PI team and let them know that these are false positives - they will take the list of PIs from there and resolve it outExample: https://gustohq.slack.com/archives/C03GUUJMB7E/p1690837978414539